<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Dexter Source: router.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	
	<link type="text/css" rel="stylesheet" href="styles/site.readable.css">
	
</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top navbar-inverse">
		<div class="navbar-inner">
			<a class="brand" href="index.html">Dexter</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu inline">
						
						<li>
							<a href="dXCollection.html">dXCollection</a>
						</li>
						
						<li>
							<a href="dXItem.html">dXItem</a>
						</li>
						
						<li>
							<a href="dXModel.html">dXModel</a>
						</li>
						
						<li>
							<a href="dXResponsiveView.html">dXResponsiveView</a>
						</li>
						
						<li>
							<a href="dXView.html">dXView</a>
						</li>
						
						<li>
							<a href="Router.html">Router</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: router.js</h1>
    
    <section>
        <article>
            <pre class="sunlight-highlight-javascript linenums">/**
 * The router manages the loading of global and routed
 * views and the behaviour on route change. We use the
 * Backbone.Router to simplify the routing.
 *
 * @class Router
 * @author: Riplexus &lt;riplexus@gmail.com>
 */

define([
    'libs/debug',
    'underscore',
    'jquery',
    'backbone',
    'modernizr',
    'configs/routes.conf',
    'configs/dexter.conf',
    'viewLoader!',
    'templateLoader!',
    'libs/applyMaybe',
    'libs/intersect',
    'libs/debugBar',
    'libs/getUrlVars',
    'shim!Object.keys'
], function(
    debug,
    _, $,
    Backbone,
    Modernizr,
    routesConf,
    dexterConf,
    viewList,
    templateList,
    applyMaybe,
    intersect,
    debugBar
) {

    debug = debug('DX');

    var AppRouter = Backbone.Router.extend({
        routes: routesConf
    });

    return /** @lends Router.prototype */{

        /**
         * Stores the Backbone.Router object.
         * TODO extend Backbone.Router directly?
         */

        obj: null,

        /**
         * Stores the current, route-linked view.
         */

        currentView: {},

        /**
         * Stores the routed views, if loaded.
         */

        viewCache: {},

        /**
         * An object with every view prototype.
         */

        viewList: null,

        /**
         * The current routing parameters.
         */

        parameters: null,

        /**
         * The main behaviour of the router is described here.
         * Load the global views first, register the routed views
         * afterwards and manage the behaviour on route change.
         */

        init: function() {
            var i, view, viewName, self;

            self = this;
            self.obj = new AppRouter();
            self.viewList = viewList;

            /*
             * Load global, navigation independent views.
             */

            for (i=dexterConf.global.length; i--;) {
                viewName = dexterConf.global[i];

                if (viewName in self.viewList) {
                    view = new (self.viewList[viewName].extend({
                        dXRouter: self
                    }))();

                    self.viewCache[viewName] = view;
                }
            }

            /*
             * Match the route to his corresponding view and
             * render it dynamically.
             */

            for (viewName in self.viewList) {
                if (self.viewList.hasOwnProperty(viewName)) {
                    (function(viewName) {

                        /*
                         * Manage route changes.
                         */

                        self.obj.on('route:'+viewName, function() {

                            /*
                             * Store the route parameters in &lt;dXRouter.parameters> for the
                             * views. The &lt;isRouting> flag will be used to clear and leave
                             * the currentView after initializing the new view with his
                             * template in &lt;dXUpdate>.
                             */

                            self.isRouting = true;
                            self.parameters = Array.prototype.slice.call(arguments);
                            self.path = Backbone.history.fragment;

                            debug.lightblue('navigate to /'+self.path);

                            /*
                             * Leave current view.
                             */

                            if ('dXLeave' in self.currentView) {
                                self.currentView.dXLeave();
                            }

                            /*
                             * Get or create the desired view instance and render
                             * it with his subviews with &lt;dXEnter>. If the view is
                             * not yet cached, the initialization will call &lt;dXEnter>.
                             */

                            if (!(viewName in self.viewCache)) {
                                view = new (self.viewList[viewName].extend({
                                    dXRouter: self
                                }))();
                                self.viewCache[viewName] = view;

                            } else {
                                view = self.viewCache[viewName];
                                if ('dXEnter' in view) {
                                    view.dXEnter();
                                }
                            }

                            // Reference current router-enabled view
                            self.currentView = view;
                        });

                    })(viewName);
                }
            }

            /*
             * Start backbone navigation.
             */

            if (Modernizr.history) {
                Backbone.history.start({ pushState: true });
            } else {
                Backbone.history.start();
            }

            /*
             * Prevent page reload on link click.
             */

            $(document).on('click', 'a[href^="/"]', function(event) {
                var href, url;

                href = $(event.currentTarget).attr('href');
                if (!event.altKey &amp;&amp; !event.ctrlKey &amp;&amp;
                    !event.metaKey &amp;&amp; !event.shiftKey) {

                    event.preventDefault();
                    url = href.replace(/^\//,'').replace(/#!/, '');
                    self.obj.navigate(url, { trigger: true });
                }
            });

            /*
             * Debugging tool
             */

            if ($.getUrlVar('debug')) {
                debugBar(self.viewCache);
            }
        }
    };

});</pre>
        </article>
    </section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					
		<span class="copyright">
		BoerseGo AG Â© 2014
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-dev</a>
		on Fri Jan 31 2014 21:51:25 GMT+0100 (CET) using the <a href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<script src="scripts/sunlight.js"></script>
	<script src="scripts/sunlight.javascript.js"></script>
	<script src="scripts/sunlight-plugin.doclinks.js"></script>
	<script src="scripts/sunlight-plugin.linenumbers.js"></script>
	<script src="scripts/sunlight-plugin.menu.js"></script>
	<script src="scripts/jquery.min.js"></script>
	<script src="scripts/jquery.scrollTo.js"></script>
	<script src="scripts/jquery.localScroll.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>


	<script>  Sunlight.highlightAll({lineNumbers:true,  showMenu: true, enableDoclinks :true}); </script>

	<script>
		$( function () {
			$( "#toc" ).toc( {
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : 60
			} );
			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );

		} );
	</script>

	

</body>
</html>
